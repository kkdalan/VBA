Sub 測試記錄單()
  
    '新增文件
    Dim oTest As Document
    Set oTest = Documents.Add
    
    '頁首
    ActiveWindow.ActivePane.View.SeekView = wdSeekCurrentPageHeader
    Selection.EndKey Unit:=wdLine, Extend:=wdExtend
    Selection.Delete Unit:=wdCharacter, Count:=1
    
    '頁尾
    ActiveWindow.ActivePane.View.SeekView = wdSeekCurrentPageFooter
    
    
    '本文
    ActiveWindow.ActivePane.View.SeekView = wdSeekMainDocument
      
    oTest.Range.InsertAfter "完成修改:" & vbCrLf
    
    Dim filePath As String
    filePath = "C:\Users\ESB12936\Desktop\ScreenMonitor\測試記錄單1.doc"
    oTest.SaveAs FileName:=filePath
    oTest.Close
    
    Debug.Print "成功產生:" & filePath

End Sub

Sub 讀取文字檔()
 
    '使用VBA讀取一文字檔
     
    Dim infile As String
    Dim str As String
    Dim outStr As String
    infile = "C:\Users\ESB12936\Desktop\ScreenMonitor\test.txt"
    
    Open infile For Input As #1
        Do While Not EOF(1)
        Line Input #1, str
        
        outStr = outStr & str & vbCrLf
    Loop
    
    Close #1
    
    Debug.Print outStr

End Sub

Sub 產生TABLE_SCHEMA文件()
    
    Dim filePath As String
    Dim newFilePath As String
    Dim caseName As String
    
    caseName = "FX_EXOTIC_DCI_OPTION"
    filePath = "C:\MRLC_SAMPLES\table_Schema_doc\MRLC-IB-010102-135_[TB_XXXXX].doc"
    newFilePath = Replace(filePath, "XXXXX", caseName)
    
    Documents.Open FileName:=filePath
    
    '頁首
    ActiveWindow.ActivePane.View.SeekView = wdSeekCurrentPageHeader
    Selection.EndKey Unit:=wdLine, Extend:=wdExtend
    Selection.Delete Unit:=wdCharacter, Count:=1
    
    Call ReplaceText(". ", ".")
    Call ReplaceText(" .", ".")
    Call ReplaceText("_ ", "_")
    Call ReplaceText(" _", "_")
    Call ReplaceText("XXXXX", "FX_EXOTIC_DCI_OPTION")
    Call ReplaceText("Xxxxx", "FxExoticDciOption")
    Call ReplaceText("xxxxx", "fxExoticDciOption")
    
    
    '本文
    ActiveWindow.ActivePane.View.SeekView = wdSeekMainDocument
    
    Call ReplaceText(". ", ".")
    Call ReplaceText(" .", ".")
    Call ReplaceText("_ ", "_")
    Call ReplaceText(" _", "_")
    Call ReplaceText("XXXXX", "FX_EXOTIC_DCI_OPTION")
    Call ReplaceText("Xxxxx", "FxExoticDciOption")
    Call ReplaceText("xxxxx", "fxExoticDciOption")

'    '頁尾
'    ActiveWindow.ActivePane.View.SeekView = wdSeekCurrentPageFooter
    
    ActiveDocument.SaveAs FileName:=newFilePath
    Debug.Print "成功產生" & newFilePath
    
    ActiveDocument.Close
    
End Sub


'***************************[ 取代文字 ]***********************************
'使用 Replacement 物件
Sub ReplaceText(oldStr As String, newStr As String)
  
   With Selection.Find
    .Text = oldStr
    .Replacement.Text = newStr
    .MatchCase = True
    .Replacement.ClearFormatting
    .ClearFormatting
    
    '全部取代
    .Execute Replace:=wdReplaceAll, Forward:=True, _
        Wrap:=wdFindContinue
   End With
   
End Sub

'***************************[ 輸出文字檔 ]***********************************
Sub writeFile(filePath As String)
  
'    Dim filePath As String
'    filePath = "C:\Users\ESB12936\Desktop\VBA_TEST.txt"
    
    Dim p
    Open filePath For Output As #1
        With ActiveDocument
            For Each p In .Sentences
                Print #1, p
            Next
        End With
    Close #1
    Debug.Print "成功寫入  " & filePath
    
End Sub


'*******************[ 整批輸出DDL ]*********************
Sub 整批輸出DDL()
    Dim fileDir As String
    Dim fs As String
    Dim i As Long
    Dim str As String
    Dim DDL_Str As String
    Dim TB_NAME As String
    
'    '新增log檔
'    Set oLog = Documents.Add
    
    '尋找目錄底下所有檔案
    fileDir = "C:\DOC\DOC_MRLC\01_BADocument\01_TableSchema\08_Limit\新增資料夾\"
    fs = Dir(fileDir & "*.*")
     
    Do Until fs = ""
        
        TB_NAME = Mid(fs, 21, Len(fs) - 25)
        
        '要產生的SQL DDL檔案路徑
        DDL_Str = fileDir & "DDL_" & TB_NAME & ".sql"
        
        Call 輸出DDL(fileDir + fs, DDL_Str)
                
'       'Log紀錄
'       oLog.Range.InsertAfter "完成修改: " & fs & vbCrLf
        Debug.Print "成功產生DDL " & DDL_Str
        fs = Dir
    Loop

End Sub

 '******************[ TableSchema輸出DDL ]********************
Sub 輸出DDL(srcPath As String, destPath As String)

'    Dim srcPath As String
'    Dim destPath As String
     
    Dim tblStr As String
    Dim tblName As String
    Dim cIsKey As String
    Dim cNameStr As String
    Dim cTypeStr As String
    Dim cLengthStr As String
    Dim cNotNull As String
    Dim boStr As String
    
    Dim newStr As String
    
    Dim r As Long
    
    '新增oDDL檔
    Set oDDL = Documents.Add
    
    '開啟檔案
'    srcPath = "C:\DOC\DOC_MRLC\01_BADocument\01_TableSchema\02_Trade\新增資料夾\MRLC-IB-010102-041_[TB_FX_KIKO_FORWARD_OPTION].doc"
    Documents.Open FileName:=srcPath
    
    '本文
    ActiveWindow.ActivePane.View.SeekView = wdSeekMainDocument
    
       If ActiveDocument.Tables.Count >= 1 Then

     '   On Error Resume Next
     
            With ActiveDocument.Tables(1)
            
                tblName = .Cell(Row:=1, Column:=1).Range.Text
                tblName = Left(tblName, Len(tblName) - 2)
                
                tblStr = "--###000 " & tblName & vbCrLf
                tblStr = tblStr & "CALL MRLC.SP_DROP_OBJ('TABLE','MRLC." & tblName & "');" & vbCrLf
                tblStr = tblStr & "CREATE TABLE MRLC." & tblName & " (" & vbCrLf
                 
                oDDL.Range.InsertAfter tblStr
                
                For r = 4 To .Rows.Count
                    
                    cIsKey = .Cell(Row:=r, Column:=2).Range.Text
                    cNameStr = .Cell(Row:=r, Column:=3).Range.Text
                    cTypeStr = .Cell(Row:=r, Column:=5).Range.Text
                    cLengthStr = .Cell(Row:=r, Column:=6).Range.Text
                    cNotNull = .Cell(Row:=r, Column:=7).Range.Text
                    boStr = .Cell(Row:=r, Column:=8).Range.Text
                    
                    cIsKey = Left(cIsKey, Len(cIsKey) - 2)
                    cNameStr = Left(cNameStr, Len(cNameStr) - 2)
                    cTypeStr = Left(cTypeStr, Len(cTypeStr) - 2)
                    cLengthStr = Left(cLengthStr, Len(cLengthStr) - 2)
                    cNotNull = Left(cNotNull, Len(cNotNull) - 2)
                    boStr = Left(boStr, Len(boStr) - 2)
                    
                    Select Case cTypeStr
                    
                      Case "INTEGER"
                        newStr = cNameStr & " " & cTypeStr
                        
                      Case "VARCHAR"
                        newStr = cNameStr & " " & cTypeStr & "(" & cLengthStr & ") CCSID 1208"
                        
                      Case "CHARACTER"
                        newStr = cNameStr & " " & cTypeStr & "(" & cLengthStr & ") CCSID 1208"
                        
                      Case "CLOB"
                        newStr = cNameStr & " " & cTypeStr & "(" & cLengthStr & ") CCSID 1208"
                        
                      Case "DECIMAL"
                         newStr = cNameStr & " " & cTypeStr & cLengthStr
                        
                      Case "TIMESTAMP"
                        newStr = cNameStr & " " & cTypeStr
                        
                      Case Default
                        MsgBox ("DATA TYPE ERROR!")
                      
                    End Select
                    
                    If cNotNull = "T" Then newStr = newStr & " NOT NULL"
                    
                    If cIsKey = "PK" Then newStr = newStr & " PRIMARY KEY"
                    
                    If r <> .Rows.Count Then newStr = newStr & " ,"
                    
                    oDDL.Range.InsertAfter "  " & newStr & vbCrLf
                    
                 Next
                 
                 tblStr = ");" & vbCrLf
                 tblStr = tblStr & "INSERT INTO MRLC.TB_SEQ_CONTROL(CONTROL_SEQ_NO,TABLE_NAME,KEY_NAME,SEQ_NO,PREFIX,REMARK)" & vbCrLf
                 tblStr = tblStr & " VALUES(000,'" & tblName & "','" & Right(tblName, Len(tblName) - 3) & "_SEQ_NO',0,'',NULL);" & vbCrLf
                 
                 oDDL.Range.InsertAfter tblStr & vbCrLf
             
             End With

        End If
        
'    Documents(srcPath).Save
    Documents(srcPath).Close
    
    oDDL.Range.Select
    
   
'    destPath = "C:\Users\ESB12936\Desktop\VBA_TEST.txt"
    Call writeFile(destPath)
    
    Debug.Print "產生DDL: " & destPath
     
    '不儲存關閉WORD
    Documents(oDDL).Close SaveChanges:=wdDoNotSaveChanges

End Sub

 '******************[ TableSchema輸出ORM ]********************
Sub 輸出ORM()

    Dim srcPath As String
    Dim destPath As String
     
    Dim tblStr As String
    Dim tblName As String
    Dim cIsKey As String
    Dim cNameStr As String
    Dim cTypeStr As String
    Dim cLengthStr As String
    Dim cNotNull As String
    Dim boStr As String
    
    Dim newStr As String
    
    Dim r As Long
    
    '新增oDDL檔
    Set oDDL = Documents.Add
    
    '開啟檔案
    srcPath = "C:\DOC\DOC_MRLC\01_BADocument\01_TableSchema\02_Trade\新增資料夾\MRLC-IB-010102-003_[TB_FX_PIVOT_OPTION].doc"
    Documents.Open FileName:=srcPath
    
    '本文
    ActiveWindow.ActivePane.View.SeekView = wdSeekMainDocument
    
       If ActiveDocument.Tables.Count >= 1 Then

            With ActiveDocument.Tables(1)
            
                tblName = .Cell(Row:=1, Column:=1).Range.Text
                tblName = Left(tblName, Len(tblName) - 2)
'
                oDDL.Range.InsertAfter tblStr
                
                For r = 18 To .Rows.Count
                    
                    cIsKey = .Cell(Row:=r, Column:=2).Range.Text
                    cNameStr = .Cell(Row:=r, Column:=3).Range.Text
                    cTypeStr = .Cell(Row:=r, Column:=5).Range.Text
                    cLengthStr = .Cell(Row:=r, Column:=6).Range.Text
                    cNotNull = .Cell(Row:=r, Column:=7).Range.Text
                    boStr = .Cell(Row:=r, Column:=8).Range.Text
                    
                    cIsKey = Left(cIsKey, Len(cIsKey) - 2)
                    cNameStr = Left(cNameStr, Len(cNameStr) - 2)
                    cTypeStr = Left(cTypeStr, Len(cTypeStr) - 2)
                    cLengthStr = Left(cLengthStr, Len(cLengthStr) - 2)
                    cNotNull = Left(cNotNull, Len(cNotNull) - 2)
                    boStr = Left(boStr, Len(boStr) - 2)
                    
                    If Not (cNameStr = "NAME" Or _
                       cNameStr = "DESCRIPTION" Or _
                       cNameStr = "STATUS" Or _
                       cNameStr = "CREATE_DATE" Or _
                       cNameStr = "AMEND_DATE" Or _
                       cNameStr = "BASIC_DATA_ID" Or _
                       cNameStr = TBL_NAME & "_SEQ_NO") _
                    Then
                       
                       If boStr <> "" Then
                            boStr = Mid(boStr, InStr(boStr, ".") + 1, Len(boStr) - InStr(boStr, "."))
                            boStr = LCase(Left(boStr, 1)) & Right(boStr, Len(boStr) - 1)
                       End If
                       
                       newStr = "<property name=""" & cNameStr & """ column=""" & boStr & """"
                       
                       If cTypeStr = "CHARACTER" And cLengthStr = "8" Then
                            newStr = newStr & " type=""com.esb.common.persistent.hibernate.HibernateVarcharDateType"" "
                          
                       ElseIf cTypeStr = "CHARACTER" And cLengthStr = "1" Then
                            newStr = newStr & " type=""true_false"" "
                       
                       End If
                        
                       newStr = newStr & " />"
                        
                       oDDL.Range.InsertAfter "   " & newStr & vbCrLf
                       
                    End If
                       
                    
                 Next
                 
'                 tblStr = ");" & vbCrLf
'                 tblStr = tblStr & "INSERT INTO MRLC.TB_SEQ_CONTROL(CONTROL_SEQ_NO,TABLE_NAME,KEY_NAME,SEQ_NO,PREFIX,REMARK)" & vbCrLf
'                 tblStr = tblStr & " VALUES(000,'" & tblName & "','" & Right(tblName, Len(tblName) - 3) & "_SEQ_NO',0,'',NULL);" & vbCrLf
                 
                 oDDL.Range.InsertAfter tblStr & vbCrLf
             
             End With

        End If
        
'    Documents(srcPath).Save
    Documents(srcPath).Close
    
    oDDL.Range.Select
    
   
    destPath = "C:\Users\ESB12936\Desktop\VBA_TEST.txt"
    Call writeFile(destPath)
    
    Debug.Print "產生ORM: " & destPath
     
    '不儲存關閉WORD
    Documents(oDDL).Close SaveChanges:=wdDoNotSaveChanges

End Sub

Sub XMLToExcel()
    ActiveWorkbook.XmlImport URL:="C:\Users\ESB12936\Desktop\FWDRPT07.xls", ImportMap:= _
        Nothing, Overwrite:=True, Destination:=Range("$A$1")
End Sub


